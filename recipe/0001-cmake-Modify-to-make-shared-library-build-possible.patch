From 606f31e8e3bebb9f5a5fb0c5237a67d85c46bfc4 Mon Sep 17 00:00:00 2001
From: Ryan Volz <ryan.volz@gmail.com>
Date: Tue, 15 Sep 2020 15:33:14 -0400
Subject: [PATCH] cmake: Modify to make shared library build possible.

---
 CMakeLists.txt | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 140910b..ad92bbd 100755
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -15,7 +15,11 @@ INCLUDE_DIRECTORIES ( include )
 INCLUDE_DIRECTORIES ( . )
 
 IF (WIN32)
-  ADD_DEFINITIONS ( -D_CRT_SECURE_NO_WARNINGS )
+  IF (BUILD_SHARED_LIBS)
+    ADD_DEFINITIONS ( -D_CRT_SECURE_NO_WARNINGS -DLOG4CPP_HAS_DLL -DLOG4CPP_BUILD_DLL )
+  ELSE (BUILD_SHARED_LIBS)
+    ADD_DEFINITIONS ( -D_CRT_SECURE_NO_WARNINGS )
+  ENDIF (BUILD_SHARED_LIBS)
 ELSE (WIN32)
   IF (APPLE)
     ADD_DEFINITIONS ( -DNDEBUG -DLOG4CPP_HAVE_SSTREAM )
@@ -82,7 +86,9 @@ ADD_LIBRARY ( ${LOG4CPP_LIBRARY_NAME}
 
 IF (WIN32)
   TARGET_LINK_LIBRARIES (${LOG4CPP_LIBRARY_NAME} kernel32 user32 ws2_32 advapi32 )
-  SET_TARGET_PROPERTIES(${LOG4CPP_LIBRARY_NAME} PROPERTIES LINK_FLAGS /NODEFAULTLIB:msvcrt )
+  IF (NOT BUILD_SHARED_LIBS)
+    SET_TARGET_PROPERTIES(${LOG4CPP_LIBRARY_NAME} PROPERTIES LINK_FLAGS /NODEFAULTLIB:msvcrt )
+  ENDIF (NOT BUILD_SHARED_LIBS)
 ENDIF (WIN32)
 
 INSTALL (
@@ -97,4 +103,6 @@ INSTALL (
 INSTALL (
   TARGETS ${LOG4CPP_LIBRARY_NAME}
   ARCHIVE DESTINATION lib
+  LIBRARY DESTINATION lib
+  RUNTIME DESTINATION bin
   )
-- 
2.20.1

